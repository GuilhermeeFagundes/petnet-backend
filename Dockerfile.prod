

FROM node:22-alpine AS base

WORKDIR /app

# OpenSSL required by Prisma
RUN apk add --no-cache openssl

# Copy manifests first for layer caching
COPY package*.json ./

# Install all dependencies for build, then prune dev deps
RUN npm ci && npm prune --production

# Copy Prisma schema and generate client during build
COPY prisma ./prisma
RUN npx prisma generate

# Copy app source
COPY . .

# Expose app port
EXPOSE 3000

CMD ["npm", "run", "start:prod"]
